<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">

  <title>Confirmation d'inscription</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    body {
      font-family: "Inter", sans-serif;
      background-color: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .confirmation-container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .confirmation-container img {
      max-width: 150px;
      margin-bottom: 20px;
    }

    .confirmation-message {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
    }
    
    .home-button {
      background: #2596be;
      border-radius: 5px;
      padding: 10px 20px;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .home-button:hover {
      background: #1e7f9c;
    }
  </style>
</head>

<body>
  <div class="confirmation-container">
    <img src="success.png" alt="Thank You Image">
    <div class="confirmation-message">
      <h2>Merci de votre inscription sur notre plateforme !</h2>
      <p>Vous recevrez un e-mail avec un lien d’authentification.</p>
    </div>
    <button class="home-button" onclick="window.location.href='https://draminesaid.com/'">Retour à l'accueil</button>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
  // Function to collect data from localStorage and send it to the API
  function sendConfirmationData() {
    // Retrieve form data from step1 and payment method from localStorage
    const step1Data = JSON.parse(localStorage.getItem('step1')) || {};

    console.log(step1Data);
    
    // Prepare the data to send to the API
    const payload = {
      nom: step1Data.lastname || "", // Changed to match PHP key
      prenom: step1Data.firstname || "", // Changed to match PHP key
      email: step1Data.email || "",
      telephone: step1Data.phone || "", // Changed to match PHP key
      password: step1Data.password || "",
      password_confirmation: step1Data.confirmPassword || "", // Use the correct key
      pmethod_client: "none" || "" // Use the same key
    };

    // Check if required data is present
    if (!payload.nom || !payload.prenom || !payload.telephone || !payload.password || !payload.password_confirmation) {
      console.warn("Incomplete data; confirmation data not sent.");
      return;
    }

    // Send data to the API using Fetch API in the background
    fetch('register.php', {  // Replace with actual API endpoint
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log("Confirmation data sent successfully:", data);

      // Clear localStorage data after successful submission
      localStorage.removeItem('step1');
      localStorage.removeItem('methodPay'); // Ensure the key matches here too

      // Redirect to the specified URL after 6 seconds
      setTimeout(() => {
        window.location.href = "https://draminesaid.com/"; // Redirect URL
      }, 20000);
    })
    .catch(error => {
      console.error("Error sending confirmation data:", error);
    });
  }

  // Call the function to send the data when the page loads
  document.addEventListener('DOMContentLoaded', sendConfirmationData);
</script>
<script>
  document.addEventListener('contextmenu', (event) => event.preventDefault());
  document.addEventListener('keydown', (event) => {
    if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I')) {
      event.preventDefault();
    }
  });
</script>


</html>
